<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no,">
    
<style>html {
    font-size: 10px;
    font-family: Roboto, Arial, sans-serif;
    word-wrap: break-word;
    background-color: #f9f9f9;
    -webkit-text-size-adjust: 100%;
    color: #030303;
}

body {
    font-family: Roboto, Arial, sans-serif;
    word-wrap: break-word;
    -webkit-text-size-adjust: 100%;
    color: #030303;
    direction: ltr;
    unicode-bidi: isolate;
    margin: 0;
    padding: 0 env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
    font-size: 1.2rem;
    overflow-x: hidden;
}

a {
    color: currentColor;
    text-decoration: none
}

[hidden][hidden] {
    display: none;
    visibility: hidden
}

@media (min-width: 1200px) {
    #columns {
        display: flex;
        justify-content: center;
        margin: 0 auto;
    }

    #primary {
        padding-right: 24px;
        margin-left: 24px;
        width: 640px;
        height: 360px;
        padding-top: 24px;
        position: relative;
    }

    custom-video {
        width: 640px;
        height: 360px;
    }

    #secondary {
        padding-right: 24px;
        width: 402px;
        min-width: 300px;
        padding-top: 24px;
    }

    .slim-video-metadata-information-standalone-badge {
        padding-top: 360px;
    }
}

.results-renderer {
    display: flex;
    -webkit-box-orient: vertical;
    -webkit-box-direction: normal;
    flex-direction: column;
}

.context-renderer {
    display: block;
    margin: 0 12px;

}


.large-media-item {
    display: block;
    min-width: 0;
    padding: 0;

}


.large-media-item-thumbnail-container {
    color: currentColor;
    text-decoration: none;
    display: block;

}


.video-thumbnail-container-large {

    display: flex;
    -webkit-box-align: center;
    align-items: center;
    -webkit-box-pack: center;
    justify-content: center;
    position: relative;
    flex-shrink: 0;
    overflow: hidden;
    padding-bottom: 56.25%;
    margin: -13px -12px 0;
    padding-top: 13px;
    margin-top: 0;
    margin-left: 0;
    margin-right: 0;

}


.video-thumbnail-bg {
    position: absolute;
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;
    width: 100%;
    min-height: 100%;
    margin: auto;
    background-color: rgba(0, 0, 0, 0.1);

}


.video-thumbnail-img {
    min-width: 1px;
    filter: none;
    position: absolute;
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;
    width: 100%;
    min-height: 100%;
    margin: auto;
    object-fit: cover;

}


.video-thumbnail-overlay-bottom-group {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    display: flex;
    -webkit-box-orient: vertical;
    -webkit-box-direction: normal;
    flex-direction: column;
    -webkit-box-align: end;
    align-items: flex-end;


}

.thumbnail-overlay-time-status-renderer {
    margin: 5px;
    padding: 1px 4px;
    border-radius: 2px;
    font-size: 1.2rem;
    color: #fff;
    background-color: rgba(0, 0, 0, 0.8);

}

.details {
    display: flex;
    -webkit-box-flex: 1;
    flex-grow: 1;
    min-width: 0;
    margin-top: 12px;
    margin-bottom: 24px;

}

.large-media-channel {
    flex-shrink: 0;

}

.channel-thumbnail-with-link-renderer {
    display: block;

}

.channel-thumbnail-icon {
    display: inline-block;
    overflow: hidden;
    flex-shrink: 0;
    border-radius: 50%;
    background-color: rgba(0, 0, 0, 0.1);
    width: 40px;
    height: 40px;

}


.profile-icon-img {
    min-width: 1px;
    min-height: 1px;
    filter: none;
    width: 100%;
    height: 100%;
    object-fit: cover;

}

.large-media-item-info {
    display: flex;
    -webkit-box-flex: 1;
    flex-grow: 1;
    min-width: 0;
    -webkit-box-align: start;
    align-items: flex-start;
    margin-left: 12px;


}

.large-media-item-metadata {
    display: flex;
    -webkit-box-flex: 1;
    flex-grow: 1;
    -webkit-box-orient: vertical;
    -webkit-box-direction: normal;
    flex-direction: column;
    min-width: 0;

}


.large-media-item-headline {
    margin: 0 0 3px;
    display: -webkit-box;
    -webkit-box-orient: vertical;
    max-height: 2.5em;
    -webkit-line-clamp: 2;
    overflow: hidden;
    line-height: 1.25;
    text-overflow: ellipsis;
    font-weight: 400;
    font-size: 1.4rem;

}

.badge-and-byline-renderer {
    -webkit-box-orient: vertical;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    max-height: 3em;
    text-overflow: ellipsis;
    overflow: hidden;

}


.badge-and-byline-item-byline {
    font-size: 1.2rem;
    margin-right: 4px;
    display: inline;
    opacity: .6;

}


.slim-video-metadata-information-standalone-badge {
    padding: 56.25% 12px 0;
    min-height: 12px;
}

.slim-video-metadata-header {
    padding: 0;
    border: none;
    outline: none;
    font: inherit;
    text-transform: inherit;
    color: inherit;
    background: transparent;
    cursor: pointer;
    margin: 0 3px 3px;
    width: calc(100% - 6px);
    text-align: initial;

}

.slim-video-information-content {
    display: flex;
    padding: 0 9px 9px;
}

.slim-video-information-title-and-badges {
    min-width: 0;
    -webkit-box-flex: 1;
    flex-grow: 1;
}

.slim-video-information-title {
    margin: 0 0 3px;
    display: -webkit-box;
    -webkit-box-orient: vertical;
    overflow: hidden;
    line-height: 1.25;
    text-overflow: ellipsis;
    font-weight: 400;
    font-size: 1.8rem;
    -webkit-line-clamp: initial;
    max-height: none;
}



.autonav-bar{
    display: flex;
    -webkit-box-align: center;
    align-items: center;
    margin: 12px;
    font-size: 1.4rem;
}

.autonav-title{

    margin: 0 0 3px;
    display: -webkit-box;
    -webkit-box-orient: vertical;
    max-height: 2.5em;
    -webkit-line-clamp: 2;
    overflow: hidden;
    line-height: 1.25;
    text-overflow: ellipsis;
    font-weight: 400;
    font-size: 1.4rem;
    -webkit-box-flex: 1;
    flex-grow: 1;
    margin-bottom: 0;

}
.item-section-renderer{
    display: block;
    border-top: 1px solid rgba(0,0,0,0.1);

}



.large-media-item-menu{
    display: flex;
    flex-shrink: 0;

}

.icon-button{
    outline: none;
    font: inherit;
    text-transform: inherit;
    color: inherit;
    cursor: pointer;
    border: none;
    background: transparent;
    width: 40px;
    height: 40px;
    padding: 8px;
    box-sizing: border-box;


}

c3-icon {
    display: inline-block;
    -webkit-flex-shrink: 0;
    flex-shrink: 0;
    width: 24px;
    height: 24px;
    fill: currentColor;
    stroke: none
}
c3-icon>svg {
    width: 100%;
    height: 100%
}


.menu-container{
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    display: flex;
    -webkit-box-align: center;
    align-items: center;
    -webkit-box-pack: center;
    justify-content: center;
    z-index: 4;


}

.menu-content{
    position: relative;
    z-index: 2;
    max-height: 100%;
    overflow-y: auto;
    color: #030303;
    background-color: #f9f9f9;
    padding: 3px;
    min-width: 250px;
    max-width: 356px;
    margin: 40px;


}

.menu-item{
    display: block;
    padding: 3px 0;

}



.menu-item-button{
    border: none;
    outline: none;
    font: inherit;
    color: inherit;
    background: transparent;
    cursor: pointer;
    box-sizing: border-box;
    display: block;
    font-size: 1.6rem;
    padding: 9px 12px;
    text-align: initial;
    text-transform: unset;
    width: 100%;

}


c3-overlay {
    position: fixed;
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: 1;
    cursor: pointer;
    background-color: rgba(0,0,0,0.8)
}

.hidden-button{
    padding: 0;
    border: none;
    outline: none;
    font: inherit;
    text-transform: inherit;
    color: inherit;
    background: transparent;
    cursor: pointer;
    position: fixed;
    top: 0;
    left: 0;
    height: 1px;
    width: 1px;

}



</style></head>
<body>


<div id="columns">
    <div id="primary">
        <custom-video></custom-video>
        <div class="slim-video-metadata-information-standalone-badge">
        </div>
        <div class="slim-video-metadata-header">
            <div class="slim-video-information-content">
                <div class="slim-video-information-title-and-badges">
                    <h2 class="slim-video-information-title">
                    </h2>
                </div>
                <c3-icon class="" role="button" aria-label="展开" aria-expanded="false">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24" viewbox="0 0 24 24" width="24">
                        <path d="M18 9.28l-6.35 6.35-6.37-6.35.72-.71 5.64 5.65 5.65-5.65z"></path>
                    </svg>
                </c3-icon>
            </div>

        </div>

        <div class="item-section-renderer">

            <div class="autonav-bar">
                <h3 class="autonav-title">
                    接下来播放
                </h3>
            </div>

            <div class="results-renderer"></div>
        </div>

    </div>
    <div id="secondary">
    </div>
</div>


<div class="menu-container" hidden="">
    <div class="menu-content">
        <div class="menu-item">
            <div class="menu-item-button">
                删除
            </div>
        </div>
    </div>
    <c3-overlay>
        <button class="hidden-button" aria-label="close"></button>
    </c3-overlay>
</div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/hls.js/1.1.2/hls.min.js"></script>


<script>function calculateLoadedPercent(video) {
    if (!video.buffered.length) {
        return '0';
    }
    return (video.buffered.end(0) / video.duration) * 100 + '%';
}

function calculateProgressPercent(video) {
    // .toFixed(5)
    return ((video.currentTime / video.duration) * 100) + '%';
}

function isMobile() {
    return /android|iPhone|iPad/i.test(navigator.userAgent || navigator.vendor || window.opera);
}

function formatDuration(ms) {
    if (isNaN(ms)) return '0:00';
    if (ms < 0) ms = -ms;
    const time = {
        hour: Math.floor(ms / 3600) % 24,
        minute: Math.floor(ms / 60) % 60,
        second: Math.floor(ms) % 60,
    };
    return Object.entries(time)
        .filter((val, index) => index || val[1])
        .map(val => (val[1] + '').padStart(2, '0'))
        .join(':');
}

class CustomVideo extends HTMLElement {
    constructor() {
        super();

        this.root = this.attachShadow({mode: 'open'});
        this.root.innerHTML = this.getTemplate();
        this.html5MainVideo = this.root.querySelector('.html5-main-video');
        this.playButton = this.root.querySelector('.play-button');
        this.fullscreenButton = this.root.querySelector('.fullscreen-button');
        this.timeSecond = this.root.querySelector('.time-second');
        this.progressBarLoaded = this.root.querySelector('.progress-bar-loaded');
        this.progressBarPlayed = this.root.querySelector('.progress-bar-played');
        this.timeFirst = this.root.querySelector('.time-first');
        this.progressBarPlayheadWrapper = this.root.querySelector('.progress-bar-playhead-wrapper');
        this.playerControlOverlay = this.root.querySelector('.player-control-overlay');


        this.playHandler = this.playHandler.bind(this);
        this.fullscreenHandler = this.fullscreenHandler.bind(this);
        this.durationChangeHandler = this.durationChangeHandler.bind(this);
        this.progressHandler = this.progressHandler.bind(this);
        this.timeupdateHandler = this.timeupdateHandler.bind(this);
        this.progressBar = this.root.querySelector('.progress-bar');
        this.playerContainer = this.root.querySelector('.player-container');
        this.playerControlContainer = this.root.querySelector('.player-control-container');
        this.playerControlContainerHandler = this.playerControlContainerHandler.bind(this);
        this.progressBar = this.root.querySelector('.progress-bar');
        this.progressBarHandler = this.progressBarHandler.bind(this);
        this.playerControlsMiddle = this.root.querySelector('.player-controls-middle');


        this.timer = 0;

        this.html5MainVideo.addEventListener("abort", ev => {
            console.log("[INFO]: abort, duration " + this.html5MainVideo.duration
                + ", videoHeight " + this.html5MainVideo.videoHeight + ", videoWidth " + this.html5MainVideo.videoWidth);
        });
        this.html5MainVideo.addEventListener("canplay", ev => {
            console.log("[INFO]: canplay, duration " + this.html5MainVideo.duration
                + ", videoHeight " + this.html5MainVideo.videoHeight + ", videoWidth " + this.html5MainVideo.videoWidth);
        });
        this.html5MainVideo.addEventListener("canplaythrough", ev => {
            console.log("[INFO]: canplaythrough, duration " + this.html5MainVideo.duration
                + ", videoHeight " + this.html5MainVideo.videoHeight + ", videoWidth " + this.html5MainVideo.videoWidth);
        });
        this.html5MainVideo.addEventListener("durationchange", ev => {
            console.log("[INFO]: durationchange, duration " + this.html5MainVideo.duration
                + ", videoHeight " + this.html5MainVideo.videoHeight + ", videoWidth " + this.html5MainVideo.videoWidth);
        });
        this.html5MainVideo.addEventListener("emptied", ev => {
            console.log("[INFO]: emptied, duration " + this.html5MainVideo.duration
                + ", videoHeight " + this.html5MainVideo.videoHeight + ", videoWidth " + this.html5MainVideo.videoWidth);
        });
        this.html5MainVideo.addEventListener("ended", ev => {
            console.log("[INFO]: ended, duration " + this.html5MainVideo.duration
                + ", videoHeight " + this.html5MainVideo.videoHeight + ", videoWidth " + this.html5MainVideo.videoWidth);
        });
        this.html5MainVideo.addEventListener("error", ev => {
            console.log("[INFO]: error, duration " + this.html5MainVideo.duration
                + ", videoHeight " + this.html5MainVideo.videoHeight + ", videoWidth " + this.html5MainVideo.videoWidth);
        });
        this.html5MainVideo.addEventListener("loadeddata", ev => {
            console.log("[INFO]: loadeddata, duration " + this.html5MainVideo.duration
                + ", videoHeight " + this.html5MainVideo.videoHeight + ", videoWidth " + this.html5MainVideo.videoWidth);
        });
        this.html5MainVideo.addEventListener("loadedmetadata", ev => {
            console.log("[INFO]: loadedmetadata, duration " + this.html5MainVideo.duration
                + ", videoHeight " + this.html5MainVideo.videoHeight + ", videoWidth " + this.html5MainVideo.videoWidth);
        });
        this.html5MainVideo.addEventListener("loadstart", ev => {
            console.log("[INFO]: loadstart, duration " + this.html5MainVideo.duration
                + ", videoHeight " + this.html5MainVideo.videoHeight + ", videoWidth " + this.html5MainVideo.videoWidth);
        });
        this.html5MainVideo.addEventListener("pause", ev => {
            console.log("[INFO]: pause, duration " + this.html5MainVideo.duration
                + ", videoHeight " + this.html5MainVideo.videoHeight + ", videoWidth " + this.html5MainVideo.videoWidth);
        });
        this.html5MainVideo.addEventListener("play", ev => {
            console.log("[INFO]: play, duration " + this.html5MainVideo.duration
                + ", videoHeight " + this.html5MainVideo.videoHeight + ", videoWidth " + this.html5MainVideo.videoWidth);
        });
        this.html5MainVideo.addEventListener("playing", ev => {
            console.log("[INFO]: playing, duration " + this.html5MainVideo.duration
                + ", videoHeight " + this.html5MainVideo.videoHeight + ", videoWidth " + this.html5MainVideo.videoWidth);
        });

        this.html5MainVideo.addEventListener("ratechange", ev => {
            console.log("[INFO]: ratechange, duration " + this.html5MainVideo.duration
                + ", videoHeight " + this.html5MainVideo.videoHeight + ", videoWidth " + this.html5MainVideo.videoWidth);
        });
        this.html5MainVideo.addEventListener("seeked ", ev => {
            console.log("[INFO]: seeked , duration " + this.html5MainVideo.duration
                + ", videoHeight " + this.html5MainVideo.videoHeight + ", videoWidth " + this.html5MainVideo.videoWidth);
        });
        this.html5MainVideo.addEventListener("seeking", ev => {
            console.log("[INFO]: seeking, duration " + this.html5MainVideo.duration
                + ", videoHeight " + this.html5MainVideo.videoHeight + ", videoWidth " + this.html5MainVideo.videoWidth);
        });
        this.html5MainVideo.addEventListener("stalled", ev => {
            console.log("[INFO]: stalled, duration " + this.html5MainVideo.duration
                + ", videoHeight " + this.html5MainVideo.videoHeight + ", videoWidth " + this.html5MainVideo.videoWidth);
        });
        this.html5MainVideo.addEventListener("suspend", ev => {
            console.log("[INFO]: suspend, duration " + this.html5MainVideo.duration
                + ", videoHeight " + this.html5MainVideo.videoHeight + ", videoWidth " + this.html5MainVideo.videoWidth);
        });

        this.html5MainVideo.addEventListener("volumechange", ev => {
            console.log("[INFO]: volumechange, duration " + this.html5MainVideo.duration
                + ", videoHeight " + this.html5MainVideo.videoHeight + ", videoWidth " + this.html5MainVideo.videoWidth);
        });
        this.html5MainVideo.addEventListener("waiting", ev => {
            console.log("[INFO]: waiting, duration " + this.html5MainVideo.duration
                + ", videoHeight " + this.html5MainVideo.videoHeight + ", videoWidth " + this.html5MainVideo.videoWidth);
        });
        this.seekingHandler = this.seekingHandler.bind(this);
        this.canplayHandler = this.canplayHandler.bind(this);

    }

    adjustSize() {
        if (this.html5MainVideo.videoHeight) {
            if (window.outerWidth >= 1200) {
                this.html5MainVideo.style.width = '640px';
                this.html5MainVideo.style.height = Math.round((this.html5MainVideo.videoHeight
                    / this.html5MainVideo.videoWidth) * 640) + 'px';
            } else {
                this.html5MainVideo.style.width = window.outerWidth + 'px';
                this.html5MainVideo.style.height = Math.round((this.html5MainVideo.videoHeight
                    / this.html5MainVideo.videoWidth) * window.outerWidth) + 'px';
            }
        }
    }

    connectedCallback() {
        this.progressOffset = 12 / this.progressBar.offsetWidth;
        this.playButton.addEventListener('click', this.playHandler);
        this.fullscreenButton.addEventListener('click', this.fullscreenHandler);
        this.html5MainVideo.addEventListener("durationchange", this.durationChangeHandler);
        this.html5MainVideo.addEventListener("durationchange", this.durationChangeHandler);
        this.html5MainVideo.addEventListener("progress", this.progressHandler);
        this.html5MainVideo.addEventListener("timeupdate", this.timeupdateHandler);
        this.html5MainVideo.addEventListener("seeking", this.seekingHandler);

        this.html5MainVideo.addEventListener("canplay", this.canplayHandler);


        this.progressBar.addEventListener('click', this.progressBarHandler);

        this.playerControlContainer.addEventListener('click', this.playerControlContainerHandler);

        window.addEventListener('hashchange', ev => {
            const values = /((\d)h)?((\d)m)?(\d)s/.exec(location.hash);
            let currentTime = 0;
            if (values[2]) {
                currentTime += parseInt(values[2]) * 3600;
            }
            if (values[4]) {
                currentTime += parseInt(values[4]) * 60;
            }
            if (values[5]) {
                currentTime += parseInt(values[5]);
            }
            this.html5MainVideo.currentTime = currentTime;
        })
    }

    canplayHandler() {
        Array.from(this.playerControlsMiddle.children).forEach(x => {
            if (x.className !== "spinner")
                x.removeAttribute('hidden')
            else
                x.setAttribute('hidden', '');
        });
    }

    seekingHandler() {
        Array.from(this.playerControlsMiddle.children).forEach(x => {
            if (x.className !== "spinner")
                x.setAttribute('hidden', '');
            else
                x.removeAttribute('hidden')
        });
    }

    progressBarHandler(event) {
        event.stopPropagation();
        let offsetXPercent =
            (event.pageX - this.progressBar.getClientRects()[0].left) /
            this.progressBar.getClientRects()[0].width;
        offsetXPercent = Math.max(0, offsetXPercent);
        offsetXPercent = Math.min(1, offsetXPercent);
        this.html5MainVideo.currentTime = this.html5MainVideo.duration * offsetXPercent;
    }

    playerControlContainerHandler() {
        this.playerControlOverlay.classList.add('fadein');
        this.showControls();
    }

    showControls() {
        clearTimeout(this.timer);
        this.timer = setTimeout(() => {
            this.playerControlOverlay.classList.remove('fadein');
        }, 3000);
    }

    disconnectedCallback() {
        this.playButton.removeEventListener('click', this.playHandler);
    }

    durationChangeHandler() {
        this.timeSecond.textContent = formatDuration(this.html5MainVideo.duration);
        this.adjustSize();
    }

    fullscreenHandler() {
        if (!document.fullscreenElement) {
            document.documentElement.requestFullscreen();
            if (window.outerWidth >= 1200) {
                this.playerContainer.style.position = 'fixed';
                this.playerContainer.style.top = '0';
                this.playerContainer.style.width = "100%";
                this.html5MainVideo.style.width = window.outerWidth + 'px';
                this.html5MainVideo.style.height = Math.round((this.html5MainVideo.videoHeight
                    / this.html5MainVideo.videoWidth) * window.outerWidth) + 'px';
                document.body.style.overflow = 'hidden';
            }
        } else {
            if (document.exitFullscreen) {
                document.exitFullscreen();
                if (window.outerWidth >= 1200) {
                    this.playerContainer.removeAttribute('style');
                    document.body.style.overflow = 'auto';
                }
                this.adjustSize();
            }
        }
    }

    getStyle() {
        return `<style>
@-webkit-keyframes spinner {
    0% {
        -webkit-transform: rotate(0deg)
    }

    to {
        -webkit-transform: rotate(1turn)
    }
}

@keyframes spinner {
    0% {
        -webkit-transform: rotate(0deg);
        transform: rotate(0deg)
    }

    to {
        -webkit-transform: rotate(1turn);
        transform: rotate(1turn)
    }
}

.spinner {
    display: block;
    box-sizing: border-box;
    margin: 12px auto;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    border: 2px solid #eee;
    border-top-color: #666;
    -webkit-animation: spinner .8s linear infinite;
    animation: spinner .8s linear infinite
}

.spinner:not([hidden]) {
    color: #333;
    font-size: 1.6rem
}

[hidden][hidden] {
    display: none;
    visibility: hidden
}
@media(min-width: 1200px)
{
    :host
    {
        width: 640px;
        height: 360px;
    }
    .player-container
    {
        width: 640px;
    }
}
.fadein {
    background-color: rgba(0,0,0,.6);
    pointer-events: auto
}
.fadein .player-controls-content
{
    visibility: visible;
}
.player-container
{
    position: absolute;
    right: env(safe-area-inset-right);
    left: env(safe-area-inset-left);
    z-index: 2;
}
.player
{
    padding-bottom: 56.25%;
    overflow: hidden;
    background-color: #000;
    display: flex;
    -webkit-box-align: center;
    align-items: center;
    -webkit-box-pack: center;
    justify-content: center;
    color: #fff;
    position: relative;
    transition: background-color .3s ease-in-out,background-image .3s ease-in-out;
    width: 100%;
    margin: 0;
    top: 0;
}
.html5-video-player
{
    width: 100%;
    height: 100%;
    overflow: hidden;
    z-index: 0;
    outline: 0;
    font-family: "YouTube Noto",Roboto,Arial,Helvetica,sans-serif;
    color: #eee;
    text-align: left;
    direction: ltr;
    font-size: 11px;
    line-height: 1.3;
    -webkit-font-smoothing: antialiased;
    -webkit-tap-highlight-color: rgba(0,0,0,0);
    touch-action: manipulation;
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #000;
}
.html5-main-video
{
    outline: 0;
    display: block;
    position: absolute;
    width: 360px;
    height: 203px;
    left: 0;
    top: 0;
}
.player-control-container
{
    -webkit-tap-highlight-color: rgba(0,0,0,0);
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
}
.player-control-overlay
{
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    touch-action: manipulation;
    transition: transform .7s,-webkit-transform .7s;
    transition-property: all;
}
.player-controls-content
{
    visibility: hidden;
}
.player-controls-top
{
    display: flex;
    position: absolute;
    top: 0;
    right: 0;
    z-index: 1;
}
.player-controls-middle
{
    display: flex;
    -webkit-box-align: center;
    align-items: center;
    -webkit-box-pack: center;
    justify-content: center;
    position: absolute;
    top: 50%;
    width: 100%;
    transform: translateY(-50%);
}
.icon-button
{
    outline: none;
    font: inherit;
    text-transform: inherit;
    color: inherit;
    cursor: pointer;
    border: none;
    background: transparent;
    box-sizing: border-box;
    height: 48px;
    width: 48px;
    padding: 6px;
}
c3-icon
{
    display: inline-block;
    flex-shrink: 0;
    fill: currentColor;
    stroke: none;
    height: 24px;
    width: 24px;
}
c3-icon>svg
{
    width: 100%;
    height: 100%;
}
.icon-button.icon-disable>c3-icon svg path
{
    fill: hsla(0,0%,100%,.7);
}
c3-icon svg path
{
    fill: #fff;
}
.player-controls-bottom
{
    display: flex;
    -webkit-box-pack: justify;
    justify-content: space-between;
    position: absolute;
    z-index: 2;
    bottom: 30px;
    width: auto;
    left: 12px;
    right: 12px;
}
.time-display
{
    display: flex;
    -webkit-box-align: center;
    align-items: center;
    margin-left: 16px;
    font-weight: 500;
}
.time-display-content
{
    display: flex;
    -webkit-box-align: center;
    align-items: center;
    pointer-events: none;
    font-size: 12px;
}
.time-first
{
    color: #fff;
}
.time-delimiter
{
    color: #fff;
    opacity: .7;
    margin: 0 4px;
}
.time-second
{
    color: #fff;
    opacity: .7;
}
.player-controls-pb
{
    display: flex;
    -webkit-box-align: center;
    align-items: center;
    position: absolute;
    bottom: 0;
    left: 30px;
    right: 30px;
    width: auto;
    z-index: 2;
    height: 30px;
}
.progress-bar
{
    cursor: pointer;
    position: relative;
    display: flex;
    align-items: center;
    padding: 0;
    width: 100%;
}
.progress-bar-line
{
    position: absolute;
    height: 3px;
    top: 50%;
    transform: translateY(-50%);
    width: calc(100% - 12px);
}
.progress-bar-background
{
    opacity: .3;
    background-color: #fff;
    position: absolute;
    height: 3px;
    width: calc(100% + 12px);
}
.progress-bar-loaded
{
    background-color: #fff;
    opacity: .6;
    pointer-events: none!important;
    position: absolute;
    height: 3px;
}
.progress-bar-played
{
    background-color: #f00;
    pointer-events: none!important;
    position: absolute;
    height: 3px;
}
.progress-bar-playhead-wrapper
{
    z-index: 0;
}
.progress-bar-playhead
{
    display: block;
    padding: 9px 18px 9px 12px;
    margin: -8px -12px;
}
.progress-bar-playhead-dot
{
    display: block;
    height: 12px;
    width: 12px;
    border-radius: 50%;
    background-color: #f00;
}
      </style>`;
    }

    getTemplate() {
        return `
      ${this.getStyle()}
    <div class="player-container">
      <div class="player">
        <div class="html5-video-player">
          <video class="html5-main-video" controlslist="nodownload">
          </video>
        </div>
      </div>
      <div class="player-control-container">
        <div class="player-control-overlay">
          <div class="player-controls-content">
            <div class="player-controls-middle">
              <button class="icon-button icon-disable" hidden="">
                <c3-icon style="width: 36px;height: 36px">
                  <svg xmlns="http://www.w3.org/2000/svg" height="24" viewbox="0 0 24 24" width="24">
                    <path d="M19,6L9,12l10,6V6L19,6z M7,6H5v12h2V6z">
                    </path>
                  </svg>
                </c3-icon>
              </button> 
              <button class="icon-button play-button" hidden="" style="width: 56px; height: 56px; padding: 0; margin: 0 60px;">
                <c3-icon style="width: 56px;height: 56px">
                  <svg xmlns="http://www.w3.org/2000/svg" height="24" viewbox="0 0 24 24" width="24" enable-background="new 0 0 24 24">
                    <g>
                      <path d="M6,4l12,8L6,20V4z">
                      </path>
                    </g>
                  </svg></c3-icon>
              </button> 
              <button class="icon-button" hidden="">
                <c3-icon style="width: 36px;height: 36px">
                  <svg xmlns="http://www.w3.org/2000/svg" height="24" viewbox="0 0 24 24" width="24">
                    <path d="M5,18l10-6L5,6V18L5,18z M19,6h-2v12h2V6z">
                    </path>
                  </svg></c3-icon>
              </button>
              <div class="spinner"></div>
            </div>
            <div class="player-controls-bottom">
              <div class="time-display">
                <div class="time-display-content">
                  <div class="time-first">
                    00:00
                  </div>
                  <div class="time-delimiter">
                    /
                  </div>
                  <div class="time-second">
                    00:00
                  </div>
                </div>
              </div><button class="icon-button fullscreen-button" style="width: 48px; height: 48px; padding: 12px;">
                <c3-icon>
                  <svg xmlns="http://www.w3.org/2000/svg" height="24" viewbox="0 0 24 24" width="24">
                    <path d="M7,11H6V6h5v1H7V11z M18,6h-5v1h4v4h1V6z M18,13h-1v4h-4v1h5V13z M11,17H7v-4H6v5h5V17z">
                    </path>
                  </svg></c3-icon>
              </button>
            </div>
            <div class="player-controls-pb">
              <div class="progress-bar">
                <div class="progress-bar-line">
                  <div class="progress-bar-background">
                  </div>
                  <div class="progress-bar-loaded">
                  </div>
                  <div class="progress-bar-played">
                  </div>
                </div>
                <div class="progress-bar-playhead-wrapper">
                  <div class="progress-bar-playhead">
                    <div class="progress-bar-playhead-dot">
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
      `;
    }

    async playHandler() {
        try {
            const response = await this.html5MainVideo.play();
            this.playButton.querySelector('path').setAttribute('d', 'M9,19H7V5H9ZM17,5H15V19h2Z');
            this.showControls();
        } catch (e) {
        }
    }

    progressHandler() {
        this.progressBarLoaded.style.width = calculateLoadedPercent(this.html5MainVideo);
    }

    set src(value) {
        if (isMobile()) {
            this.html5MainVideo.src = value;
        } else {
            if (value.indexOf('.mp4') !== -1 || this.html5MainVideo.canPlayType('application/vnd.apple.mpegurl')) {
                this.html5MainVideo.src = value;
            } else if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(value);
                hls.attachMedia(this.html5MainVideo);
            }
        }
        this.playerControlOverlay.classList.add('fadein');
    }

    timeupdateHandler() {
        this.timeFirst.textContent = formatDuration(this.html5MainVideo.currentTime);
        this.progressBarPlayed.style.width = calculateProgressPercent(this.html5MainVideo);
        const v = ((this.html5MainVideo.currentTime / this.html5MainVideo.duration) * 100);
        this.progressBarPlayheadWrapper.style.marginLeft =
            (v - this.progressOffset * v) + '%';
    }
}

customElements.define("custom-video", CustomVideo);

/*


(function () {
    const elements = $0.querySelectorAll('dt code');
    const array=[];

    for (const element of elements) {
        array.push(`this.html5MainVideo.addEventListener("${element.textContent}",ev=>{
        console.log("[INFO]: ${element.textContent}, duration "+this.html5MainVideo.duration
        +", videoHeight "+this.html5MainVideo.videoHeight+", videoWidth "+this.html5MainVideo.videoWidth);
        });`);
    }
    console.log(array.join('\n'));
})();

(function () {
    const elements = $0.querySelectorAll('dt code');
    const array=[];

    for (const element of elements) {
        array.push(`${element.textContent}`);
    }
    console.log(array.join('\n'));
})();
(function () {
    const elements = $0.querySelectorAll('dt code');
    const array=[];

    for (const element of elements) {
        array.push(`
         this.${element.textContent}Handler = this.${element.textContent}Handler.bind(this);
         ${element.textContent}Handler(){
         }
         this.html5MainVideo.addEventListener("${element.textContent}", this.${element.textContent}Handler);
        `);
    }
    console.log(array.join('\n'));
})();

https://developer.mozilla.org/en-US/docs/Web/API/HTMLMediaElement

 */

const customVideo = document.querySelector('custom-video');

function substringAfterLast(string, delimiter, missingDelimiterValue) {
    const index = string.lastIndexOf(delimiter);
    if (index === -1) {
        return missingDelimiterValue || string;
    } else {
        return string.substring(index + delimiter.length);
    }
}

function substringBeforeLast(string, delimiter, missingDelimiterValue) {
    const index = string.lastIndexOf(delimiter);
    if (index === -1) {
        return missingDelimiterValue || string;
    } else {
        return string.substring(0, index);
    }
}

function humanFileSize(size) {
    if (size === 0)
        return '0';
    var i = Math.floor(Math.log(size) / Math.log(1024));
    return (size / Math.pow(1024, i)).toFixed(2) * 1 + ' ' + ['B', 'kB', 'MB', 'GB', 'TB'][i]
}

async function loadData() {
    const response = await fetch('api/files?v=/storage/FD12-1F1D/Movies');
    const items = await response.json();
    const buffer = [];
    items.filter(x => !x.isDirectory && x.path.endsWith(".mp4")).forEach(x => {
        const template = `<div class="context-renderer">
                <div class="large-media-item">
                    <a class="large-media-item-thumbnail-container" data-href="/api/files?v=${x.path}">
                        <div class="video-thumbnail-container-large">
                            <div class="video-thumbnail-bg">
                            </div><img class="video-thumbnail-img" src="/api/files?v=${substringBeforeLast(x.path, ".")}.jpg"="">
                            <div class="video-thumbnail-overlay-bottom-group">
                                <div class="thumbnail-overlay-time-status-renderer">
                                    ${humanFileSize(x.size)}
                                </div>
                            </div>
                        </div>
                    </a>
                    <div class="details">
                        <div class="large-media-channel">
                            <div class="channel-thumbnail-with-link-renderer">
                                <a>
                                    <div class="channel-thumbnail-icon">
                                        <img class="profile-icon-img">
                                    </div>
                                </a>
                            </div>
                        </div>
                        <div class="large-media-item-info">
                            <div class="large-media-item-metadata">
                                <a href="/api/files?v=${x.path}">
                                    <h3 class="large-media-item-headline">
                                    ${substringAfterLast(x.path, "/")}
                                    </h3>
                                    <div class="badge-and-byline-renderer">
                                        <div class="badge-and-byline-item-byline">
                                        </div>
                                    </div>
                                </a>
                            </div>
                            
<div class="large-media-item-menu">
<button class="icon-button">
<c3-icon><svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="24" viewbox="0 0 24 24" width="24"><path d="M12,16.5c0.83,0,1.5,0.67,1.5,1.5s-0.67,1.5-1.5,1.5s-1.5-0.67-1.5-1.5S11.17,16.5,12,16.5z M10.5,12 c0,0.83,0.67,1.5,1.5,1.5s1.5-0.67,1.5-1.5s-0.67-1.5-1.5-1.5S10.5,11.17,10.5,12z M10.5,6c0,0.83,0.67,1.5,1.5,1.5 s1.5-0.67,1.5-1.5S12.83,4.5,12,4.5S10.5,5.17,10.5,6z"></path></svg></c3-icon>
</button>

</div>
                        </div>
                    </div>
                </div>
            </div>`;
        buffer.push(template);
    })
    document.querySelector('.results-renderer')
        .innerHTML = buffer.join('');

    const slimVideoInformationTitle = document.querySelector('.slim-video-information-title');

    document.querySelectorAll('.large-media-item-thumbnail-container')
        .forEach(x => {
            x.parentNode.querySelector('.large-media-item-menu')
                .addEventListener('click', evt => {
                    evt.stopPropagation();
                    menuContainer.setAttribute('data-href', x.getAttribute('data-href'));
                    menuContainer.removeAttribute('hidden');
                });

            x.parentNode.querySelector('.large-media-item-info a')
                .addEventListener('click', evt => {
                    evt.preventDefault();
                    customVideo.src = x.getAttribute('data-href');
                    slimVideoInformationTitle.textContent = x.parentNode.querySelector('h3').textContent;
                });
            x.addEventListener('click', evt => {
                customVideo.src = x.getAttribute('data-href');
                slimVideoInformationTitle.textContent = x.parentNode.querySelector('h3').textContent;
            })
        })

}


const menuContainer = document.querySelector('.menu-container');

document.querySelector('.menu-container c3-overlay')
    .addEventListener('click', evt => {
        menuContainer.setAttribute('hidden', '');
    });


loadData();
</script></body>
</html>